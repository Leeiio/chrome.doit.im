<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Doit.im | Online Task and Time Management System, Always Online, Always With You !</title>
<meta name="keywords" content="Doit.im, GTD, time management, task management, What's GTD, GTD app, GTD software, GTD mobile, GTD download, GTD Android, GTD iPhone, GTD Web, GTD iPad, GTD PC, GTD Windows, GTD Linux, GTD Mac" />
<meta name="description" content="Doit.im adopts the excellent task management principles GTD to guide you to get rid of various pending ideas in mind, help you organize tasks and focus on important items, so as to closely track work and feel easy when facing up bulks of complicated projects. With no pressure but efficiency, you'll better enjoy your work and get unexpected success." />
<link rel="stylesheet" href="css/base.css" type="text/css" />
<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="css/options.css" type="text/css" />
<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="/js/date.js" type="text/javascript"></script>
<script src="js/base64.js" type="text/javascript"></script>
<script src="js/doit.js" type="text/javascript"></script>
<!-- <script src="js/js.js" type="text/javascript"></script> -->
<script src="js/options.js" type="text/javascript"></script>
<script type="text/javascript">
    var L = chrome.i18n.getMessage;
    $(document).ready(function() {
        $('#register').text(L('option_sign_up_a_new_account_in_Doitim'));
        $('#auth_logout').text(L('option_logout'));
        //登录
        $('.signin-form').bind('submit',function(){
            var username = $('#signin_username').val();
            var password = $('#signin_password').val();
            if(!username && !password){
                $(this).find('input').parent().addClass('error');
                return false;
            }
            var auth = Base64.encode(username + ':' + password);
            $.ajax({
                url: PROFILE_URL,
                dataType: 'json',
                beforeSend: function(req){
                    req.setRequestHeader('Authorization', 'Basic ' + auth)
                },
                contentType: "application/json; charset=utf-8",
                complete: function(resp) {
                    var status = resp.status;
                    var data = JSON.parse(resp.responseText);
                    localStorage.setItem('account',JSON.stringify(data));
                    var account = data.account;
                    var username = data.username;
                    var created = new Date(data.created).toString('yyyy-MM-dd');
                    var $account_info = $('#account_info');
                    $account_info.find('.account .value').html(account);
                    $account_info.find('.email .value').html(username);
                    $account_info.find('.registed .value').html(created);
                    $account_info.show();
                    if(status == 401) {
                        $('.signin-form input').parent().addClass('error');
                        $('#signin_error').html('incorrect Username/Email or Password').show();
                    }else if(status == 200){
                        localStorage.setItem('user_auth',auth);
                        location.reload();
                    }
                }
            });        
            return false;
        });
        $('.signin-form').find('input').bind('keyup keydown',function(){
            if($(this).val()){
                $(this).parent().removeClass('error');
            }
        });
    });
</script>
</head>
<body>
    <div id="wrap">
        <div id="header">
            <div id="option_logo">
                <a href="http://doit.im"><img src="../imgs/option-logo.png" /></a>
            </div>
        </div>
        <div id="body">
            <div id="register_wrap">
                <a id="register" target="_blank" href="https://i.doit.im/register">前往&nbsp;Doit.im&nbsp;注册一个新帐号</a>
            </div>
            <div id="account_info" style="display:none">
                <ul class="account-list">
                    <li class="account"><span class="attr">Username:</span><span class="value"></span></li>
                    <li class="email"><span class="attr">Email:</span><span class="value"></span></li>
                    <li class="registed"><span class="attr">Registered:</span><span class="value"></span></li>
                </ul>
            </div>
            <div>
                <a id="auth_logout" href="#">已登录，退出</a>
            </div>
            <div id="option_please_login"  class="signin-form">
                <div id="signin_error" class="alert alert-error" style="display:none"></div>
                <form method="post" action="" id="signin_form">
                    <p class="control-group"><input id="signin_username" autofocus="autofocus" type="text" placeholder="Username" /></p>
                    <p class="control-group"><input id="signin_password" type="password" placeholder="Password" /></p>
                    <p class="forget-password"><a target="_blank" href="https://i.doit.im/forget_password">Forgot password?</a></p>
                    <p><button id="signin_submit" class="btn btn-primary" type="submit">Submit</button></p>
                </form>
            </div>
        </div>
    </div>
</body>
</html>